<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WPCV1 Orchestrator</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    label { display: block; margin-top: 1em; }
    select, input, button { margin-top: 0.5em; width: 100%; padding: 0.5em; }
    pre { background: #f4f4f4; padding: 1em; border-radius: 5px; white-space: pre-wrap; }
    details { margin-top: 2em; }
    summary { font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

  <h1>🧠 WPCV1 Orchestrator</h1>
<select id="logSelector">
  <option value="">-- View Logs --</option>
  <option value="session.log">Session Log</option>
  <option value="integrity.log">Integrity Check</option>
  <option value="history.log">Run History</option>
</select>

<iframe id="logViewer" style="width:100%; height:300px; border:1px solid #ccc;"></iframe>

  <form id="orchestratorForm">
    <label>Mode:</label>
    <select name="mode">
      <option value="prompt">Prompt</option>
      <option value="validate">Validate</option>
      <option value="scaffold">Scaffold</option>
    </select>

    <label>Agent:</label>
    <select name="agent">
      <option value="">—</option>
      <option value="deepseek">DeepSeek</option>
      <option value="openai">OpenAI</option>
      <option value="grok">Grok</option>
      <option value="gemini">Gemini</option>
      <option value="local">Local</option>
    </select>

    <label>File Path:</label>
    <input type="text" name="file" placeholder="/path/to/code.js">

    <label>Expectations Path:</label>
    <input type="text" name="expectation" placeholder="/path/to/expectations.md">

    <button type="submit">Run</button>
  </form>

  <pre id="output">Results will appear here...</pre>

  <details>
    <summary>📘 Workflow Reference</summary>
    <pre>
🧠 Mode: prompt
- Purpose: Send user prompt to selected agent
- Requires: --agent
- Flow: call_agent() → API → reply → log + save

🧪 Mode: validate
- Purpose: Validate code against expectations
- Requires: --file (code), optional --expect
- Flow: dispatcher.run_validation() → results → console

🔍 Mode: validate-only
- Purpose: Check required CLI tools
- No file or agent needed
- Flow: cmd_validator.validate_commands() → results → log

🧰 Mode: scaffold
- Purpose: Generate expectations.md for selected folder/agent
- Flow: scaffold_expectations() → optionally auto-validate
    </pre>
  </details>

  <script>
    document.getElementById("orchestratorForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);

      fetch("orchestrator.php", {
        method: "POST",
        body: formData
      })
      .then(res => res.text())
      .then(data => document.getElementById("output").textContent = data);
    });
document.getElementById('logSelector').addEventListener('change', function() {
  const file = this.value;
  const viewer = document.getElementById('logViewer');
  if (file) {
    viewer.src = `preview.php?file=${encodeURIComponent(file)}`;
  } else {
    viewer.src = '';
  }
});

  </script>

</body>
</html>
